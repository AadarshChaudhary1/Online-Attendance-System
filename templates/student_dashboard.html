<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { display: flex; min-height: 100vh; margin: 0; font-family: Arial, sans-serif; }
        #sidebar { width: 250px; background: #343a40; color: white; }
        #sidebar a { color: white; text-decoration: none; display: block; padding: 12px 20px; }
        #sidebar a:hover { background: #495057; }
        #main { flex: 1; padding: 30px; background: #f8f9fa; }
        h2, h3 { margin-top: 0; }
        .card { margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3 class="p-3">Student Panel</h3>
    <p class="text-center"><strong>{{ name }}</strong></p>
    <a href="{{ url_for('student.student_dashboard') }}">üìä Dashboard</a>
    <a href="{{ url_for('student.student_change_password') }}">üîí Change Password</a>
    <a href="{{ url_for('auth.logout') }}">üö™ Logout</a>
</div>

<div id="main">
    <h2>üëã Welcome, {{ name }}!</h2>
    <p class="lead">Here‚Äôs a summary of your attendance record, broken down by subject.</p>
    <hr>

    <div class="row">
      
        <div class="col-md-4">
            <div class="card shadow-sm text-center">
                <div class="card-header">
                    <h5 class="card-title mb-0">Overall Summary</h5>
                </div>
                <div class="card-body">
                    <h3 class="card-title">{{ overall_percent|default(0)|round(2) }}%</h3>
                    <p class="card-text">
                        <strong>Total Classes Attended:</strong> {{ total_present }}<br>
                        <strong>Total Classes Held:</strong> {{ total_classes }}
                    </p>
                </div>
            </div>
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Download Full Report</h5>
                    <p>Get a detailed day-by-day log for all your subjects.</p>
                    <a href="{{ url_for('student.download_report', report_type='pdf') }}" class="btn btn-danger btn-sm">‚¨áÔ∏è Download PDF</a>
                    <a href="{{ url_for('student.download_report', report_type='csv') }}" class="btn btn-success btn-sm">‚¨áÔ∏è Download CSV</a>
                </div>
            </div>
        </div>

        
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Subject-wise Attendance</h5>
                    <table class="table table-bordered table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Subject Code</th>
                                <th>Subject Name</th>
                                <th>Present</th>
                                <th>Total</th>
                                <th>Percent</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if summary %}
                                {% for s in summary %}
                                <tr class{% if s.percent < 75 %}"table-danger"{% elif s.percent < 90 %}"table-warning"{% endif %}>
                                    <td>{{ s.subject_code }}</td>
                                    <td>{{ s.subject_name }}</td>
                                    <td>{{ s.present }}</td>
                                    <td>{{ s.total }}</td>
                                    <td>{{ s.percent }}%</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center text-danger">No attendance records found</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

  
    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h5 class="card-title">Detailed Attendance Log</h5>
            <div style="max-height: 400px; overflow-y: auto;">
                <table class="table table-sm table-striped">
                    <thead class="table-light" style="position: sticky; top: 0;">
                        <tr>
                            <th>Date</th>
                            <th>Subject</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if records %}
                            {% for record in records %}
                            <tr>
                                <td>{{ record['date'] }}</td>
                                <td>{{ record['subject_name'] }}</td>
                                <td>{{ record['status'] }}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="3" class="text-center">No details found.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

</body>
</html>