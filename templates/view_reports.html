<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Attendance Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>All Students Attendance Report</h2>

  
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{ category }} mt-2">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}


    <form method="POST" class="row g-3 mb-4">
        <div class="col-md-3">
            <input type="text" name="year" class="form-control" placeholder="Year" value="{{ year or '' }}">
        </div>
        <div class="col-md-3">
            <input type="text" name="section" class="form-control" placeholder="Section" value="{{ section or '' }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
    </form>

    {% if reports %}
    
    <div class="mb-3">
        <a href="{{ url_for('admin.download_all_reports', file_type='csv') }}?year={{ year }}&section={{ section }}" class="btn btn-success">⬇️ Download CSV</a>
        <a href="{{ url_for('admin.download_all_reports', file_type='xlsx') }}?year={{ year }}&section={{ section }}" class="btn btn-info">⬇️ Download Excel</a>
        <a href="{{ url_for('admin.download_all_reports', file_type='pdf') }}?year={{ year }}&section={{ section }}" class="btn btn-danger">⬇️ Download PDF</a>
    </div>


    <table class="table table-bordered table-striped">
        <thead class="table-dark">
            <tr>
                <th>MIS Number</th>
                <th>Name</th>
                <th>Classes Attended</th>
                <th>Total Classes</th>
                <th>Attendance %</th>
            </tr>
        </thead>
        <tbody>
            {% for mis_no, name, attended, total, percent in reports %}
            <tr>
                <td>{{ mis_no }}</td>
                <td>{{ name }}</td>
                <td>{{ attended }}</td>
                <td>{{ total }}</td>
                <td>{{ percent }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="alert alert-warning text-center">
        No students found{% if year and section %} in Year "{{ year }}", Section "{{ section }}"{% endif %}.
    </div>
    {% endif %}

    <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>
</body>
</html>
